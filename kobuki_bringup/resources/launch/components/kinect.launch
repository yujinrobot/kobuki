<launch>
  <rosparam file="$(find kobuki_bringup)/resources/yaml/kinect.yaml" command="load" ns="/camera/driver"/>
  
  <!-- Load standard constellation of processing nodelets -->
  <include file="$(find openni_launch)/launch/openni.launch" ns="/">
    <arg name="camera" value="camera"/>
    <arg name="publish_tf" default="false"/>
  </include>

  <!-- throttling -->
  <node pkg="nodelet" type="nodelet" name="pointcloud_throttle"
       args="load pointcloud_to_laserscan/CloudThrottle /camera_nodelet_manager" respawn="true">
    <param name="max_rate" value="20.0"/>
    <remap from="cloud_in" to="camera/depth/points"/>
    <remap from="cloud_out" to="cloud_throttled"/>
  </node>
  
  <!-- Fake Laser -->
  <node pkg="nodelet" type="nodelet" name="kinect_laser"
      args="load pointcloud_to_laserscan/CloudToScan /camera_nodelet_manager" respawn="true">
    <param name="output_frame_id" value="/camera_depth_frame"/>
    <!-- heights are in the (optical?) frame of the kinect -->
    <param name="min_height" value="-0.32"/>
    <param name="max_height" value="0.32"/>
    <remap from="cloud" to="cloud_throttled"/>
  </node>

  <!-- Fake Laser (narrow one, for localization -->
  <node pkg="nodelet" type="nodelet" name="kinect_laser_narrow"
       args="load pointcloud_to_laserscan/CloudToScan /camera_nodelet_manager" respawn="true">
    <param name="output_frame_id" value="/camera_depth_frame"/>
    <!-- heights are in the (optical?) frame of the kinect -->
    <param name="min_height" value="-0.025"/>
    <param name="max_height" value="0.025"/>
    <remap from="cloud" to="cloud_throttled"/>
    <remap from="scan" to="narrow_scan"/>
  </node>
</launch>
